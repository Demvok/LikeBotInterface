<div class="content-wrapper">
  <header>
    <div class="header-title">
      <h1>–ù–∞–±—ñ—Ä –µ–º–æ–¥–∑—ñ</h1>
    </div>
    <div class="header-actions">
      <button class="btn-primary" (click)="openCreateForm()" [disabled]="isGuest()">+ –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–∞–ª—ñ—Ç—Ä—É</button>
    </div>
  </header>

  <main>
    @if (loading) {
      <div class="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
    }
    @if (error) {
      <div class="error">{{ error }}</div>
    }

    <!-- Create Form Modal -->
    @if (showCreateForm) {
      <div class="modal-overlay" (click)="cancelCreateForm()">
        <div class="modal-dialog" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>–°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É –ø–∞–ª–µ—Ç—É</h2>
            <button class="modal-close" (click)="cancelCreateForm()">&times;</button>
          </div>
          <div class="modal-body">
            @if (formError) {
              <div class="form-error">{{ formError }}</div>
            }
            <form (ngSubmit)="submitCreateForm()">
              <div class="form-group">
                <label for="create-name">–ù–∞–∑–≤–∞ –ø–∞–ª–µ—Ç–∏:</label>
                <input 
                  id="create-name"
                  type="text" 
                  [(ngModel)]="formName" 
                  name="formName"
                  placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É"
                  [disabled]="formSubmitting"
                />
              </div>
              <div class="form-group">
                <label for="create-description">–û–ø–∏—Å (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ):</label>
                <textarea 
                  id="create-description"
                  [(ngModel)]="formDescription" 
                  name="formDescription"
                  placeholder="–í–≤–µ–¥—ñ—Ç—å –æ–ø–∏—Å –ø–∞–ª–µ—Ç–∏..."
                  [disabled]="formSubmitting"
                ></textarea>
              </div>
              <div class="form-group">
                <label for="create-emojis">–ï–º–æ–¥–∑—ñ (—Ä–æ–∑–¥—ñ–ª–µ–Ω—ñ –ø—Ä–æ–±—ñ–ª–æ–º –∞–±–æ –∫–æ–º–æ—é):</label>
                <div class="emoji-input-group">
                  <textarea 
                    id="create-emojis"
                    [(ngModel)]="formEmojis" 
                    name="formEmojis"
                    placeholder="üòä üò¢ üò° ‚ù§Ô∏è"
                    [disabled]="formSubmitting"
                  ></textarea>
                  <button type="button" class="btn-emoji" (click)="openEmojiPicker()" [disabled]="formSubmitting" title="–í–∏–±–µ—Ä—ñ—Ç—å –µ–º–æ–¥–∑—ñ">
                    üòä
                  </button>
                </div>
              </div>
              <div class="form-group checkbox">
                <label for="create-order">
                  <input 
                    id="create-order"
                    type="checkbox" 
                    [(ngModel)]="formOrdered" 
                    name="formOrdered"
                    [disabled]="formSubmitting"
                  />
                  –í–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞
                </label>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" (click)="cancelCreateForm()" [disabled]="formSubmitting" class="btn-secondary">
              –°–∫–∞—Å—É–≤–∞—Ç–∏
            </button>
            <button type="submit" [disabled]="formSubmitting" class="btn-success" (click)="submitCreateForm()">
              {{ formSubmitting ? '–°—Ç–≤–æ—Ä–µ–Ω–Ω—è...' : '–°—Ç–≤–æ—Ä–∏—Ç–∏' }}
            </button>
          </div>
        </div>
      </div>
    }

    <!-- Edit Form Modal -->
    @if (showEditForm && editingPalette) {
      <div class="modal-overlay" (click)="cancelEditForm()">
        <div class="modal-dialog" (click)="$event.stopPropagation()">
          <div class="modal-header">
            <h2>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø–∞–ª–µ—Ç—É</h2>
            <button class="modal-close" (click)="cancelEditForm()">&times;</button>
          </div>
          <div class="modal-body">
            @if (formError) {
              <div class="form-error">{{ formError }}</div>
            }
            <form (ngSubmit)="submitEditForm()">
              <div class="form-group">
                <label for="edit-name">–ù–∞–∑–≤–∞ –ø–∞–ª–µ—Ç–∏:</label>
                <input 
                  id="edit-name"
                  type="text" 
                  [(ngModel)]="formName" 
                  name="formName"
                  placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É"
                  [disabled]="true"
                  readonly
                />
              </div>
              <div class="form-group">
                <label for="edit-description">–û–ø–∏—Å (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ):</label>
                <textarea 
                  id="edit-description"
                  [(ngModel)]="formDescription" 
                  name="formDescription"
                  placeholder="–í–≤–µ–¥—ñ—Ç—å –æ–ø–∏—Å –ø–∞–ª–µ—Ç–∏..."
                  [disabled]="formSubmitting"
                ></textarea>
              </div>
              <div class="form-group">
                <label for="edit-emojis">–ï–º–æ–¥–∑—ñ (—Ä–æ–∑–¥—ñ–ª–µ–Ω—ñ –ø—Ä–æ–±—ñ–ª–æ–º –∞–±–æ –∫–æ–º–æ—é):</label>
                <div class="emoji-input-group">
                  <textarea 
                    id="edit-emojis"
                    [(ngModel)]="formEmojis" 
                    name="formEmojis"
                    placeholder="üòä üò¢ üò° ‚ù§Ô∏è"
                    [disabled]="formSubmitting"
                  ></textarea>
                  <button type="button" class="btn-emoji" (click)="openEmojiPicker()" [disabled]="formSubmitting" title="–í–∏–±–µ—Ä—ñ—Ç—å –µ–º–æ–¥–∑—ñ">
                    üòä
                  </button>
                </div>
              </div>
              <div class="form-group checkbox">
                <label for="edit-order">
                  <input 
                    id="edit-order"
                    type="checkbox" 
                    [(ngModel)]="formOrdered" 
                    name="formOrdered"
                    [disabled]="formSubmitting"
                  />
                  –í–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞
                </label>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" (click)="cancelEditForm()" [disabled]="formSubmitting" class="btn-secondary">
              –°–∫–∞—Å—É–≤–∞—Ç–∏
            </button>
            <button type="submit" [disabled]="formSubmitting" class="btn-success" (click)="submitEditForm()">
              {{ formSubmitting ? '–û–Ω–æ–≤–ª–µ–Ω–Ω—è...' : '–û–Ω–æ–≤–∏—Ç–∏' }}
            </button>
          </div>
        </div>
      </div>
    }

    <!-- Emoji Picker Modal -->
    @if (showEmojiPicker) {
      <div class="emoji-picker-overlay" (click)="closeEmojiPicker()">
        <div class="emoji-picker-container-modal" (click)="$event.stopPropagation()">
          <app-emoji-picker 
            [allowedEmojis]="allowedEmojis"
            (emojiSelected)="onEmojiSelected($event)"
            (pickerClosed)="onEmojiPickerClosed()"
          ></app-emoji-picker>
        </div>
      </div>
    }

  @if (!loading && palettes.length > 0) {
    <div class="palettes-container">
      <div class="palettes-list">
      @for (p of palettes; track p.palette_name) {
        <div class="palette-item" [class.selected]="isSelected(p)">
          <div class="palette-content" (click)="selectPalette(p)">
            <div class="palette-name">{{ p.palette_name }}</div>
            @if (p.description) {
              <div class="palette-description">{{ p.description }}</div>
            }
            @if (p.ordered) {
              <div class="palette-order-badge">–í–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–∞</div>
            }
            <div class="palette-emojis">
              @for (e of p.emojis; track $index) {
                <span>{{ e }}&nbsp;</span>
              }
            </div>
          </div>
          <div class="palette-actions">
            <button class="btn-edit" (click)="openEditForm(p)" [disabled]="isGuest()" title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏">‚úé</button>
            <button class="btn-delete" (click)="deletePalette(p)" [disabled]="isGuest()" title="–í–∏–¥–∞–ª–∏—Ç–∏">üóë</button>
          </div>
        </div>
      }
      </div>
    </div>
  }

  @if (!loading && palettes.length === 0 && !error) {
    <div class="empty-state">
      <p>–ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –Ω–∞–±–æ—Ä—ñ–≤ –µ–º–æ—Ü—ñ–π.</p>
      <button class="btn-link" (click)="openCreateForm()">–°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–µ—Ä—à—É –ø–∞–ª–µ—Ç—É.</button>
    </div>
  }

  </main>

  <footer>
    <p>¬© 2025 LikeBot - –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –Ω–∞–±–æ—Ä–∞–º–∏ –µ–º–æ–¥–∑—ñ</p>
  </footer>
</div>
