<div class="content-wrapper">
    <header>
        <div style="display: flex; align-items: center; justify-content: space-between;">
            <div style="display: flex; flex-direction: column; align-items: flex-start; min-width: 120px;">
                <a routerLink="/tasks" class="return-link">‚Üê Tasks</a>
                <div class="task-id-header" *ngIf="task" style="font-size: 1.2rem; font-weight: bold; color: var(--color-text-dark); font-family: 'Courier New', monospace; letter-spacing: 0.1rem;">
                    #{{ task.task_id }}
                </div>
            </div>
            <div style="text-align: center; flex: 1;">
                <h1>Task Overview</h1>
                <div class="task-title" *ngIf="task">{{ task.name }}</div>
            </div>
            <div style="min-width: 120px;"></div> <!-- Spacer for balance -->
        </div>
    </header>

        <!-- Auto-refresh progress line (only while running) -->
        <div class="auto-refresh-progress" *ngIf="task?.status === 'RUNNING'"
            [style.width.%]="(secondsUntilRefresh / 10) * 100"></div>

    <main>
        <ng-container *ngIf="loading">
            <div class="loading-state">
                <div class="loading-spinner"></div>
                <p>Loading task information...</p>
            </div>
        </ng-container>
        
        <ng-container *ngIf="error">
            <div class="error-state">
                <div class="error-icon">‚ö†Ô∏è</div>
                <p>{{ error }}</p>
            </div>
        </ng-container>
        
        <ng-container *ngIf="!loading && !error && task">
            <div class="task-info-grid">
                <!-- Status & Timeline Card -->
                <div class="info-card status-card">
                    <div class="card-header">
                        <h3>Status & Timeline</h3>
                    </div>
                    <div class="card-content">
                        <div class="status-badge" [ngClass]="'status-' + (task.status || 'unknown').toLowerCase()">
                            {{ getStatusText(task.status || 'UNKNOWN') }}
                        </div>
                        
                        <!-- Timeline Section -->
                        <div class="timeline-section">
                            <h4 class="timeline-header">Timeline</h4>
                            <div class="timestamp-item">
                                <div class="timestamp-label">Created</div>
                                <div class="timestamp-value">{{ task.created_at | date:'MMM d, y, h:mm a' }}</div>
                            </div>
                            <div class="timestamp-item">
                                <div class="timestamp-label">Last Updated</div>
                                <div class="timestamp-value">{{ task.updated_at | date:'MMM d, y, h:mm a' }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Details & Statistics Card -->
                <div class="info-card action-card">
                    <div class="card-header">
                        <h3>Action Details & Statistics</h3>
                    </div>
                    <div class="card-content">
                        <!-- Statistics Section -->
                        <div style="margin-bottom: 1.5rem; display: flex; justify-content: space-around; text-align: center;">
                            <div class="stat-item">
                                <div class="stat-value">{{ task.post_ids.length }}</div>
                                <div class="stat-label">Posts</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">{{ task.accounts.length }}</div>
                                <div class="stat-label">Accounts</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">{{ kpisLoading ? '‚Äî' : (kpis.successRate + '%') }}</div>
                                <div class="stat-label">Success</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">{{ kpisLoading ? '‚Äî' : kpis.errorCount }}</div>
                                <div class="stat-label">Errors</div>
                            </div>
                        </div>
                        <div class="action-type">
                            <span class="label">Type:</span>
                            <span class="value action-type-badge" [ngClass]="'action-' + task.action.type">
                                {{ getActionTypeText(task.action.type) }}
                            </span>
                        </div>
                        <div class="action-details" *ngIf="task.action.type === 'react' && task.action.palette">
                            <span class="label">Reaction Type:</span>
                            <span class="value palette-badge" [ngClass]="'palette-' + task.action.palette">
                                {{ task.action.palette | titlecase }}
                            </span>
                        </div>
                        <div class="action-details" *ngIf="task.action.type === 'comment' && task.action.content">
                            <span class="label">Comment:</span>
                            <span class="value comment-preview">"{{ task.action.content }}"</span>
                        </div>
                    </div>
                </div>

                <!-- Task Management Actions Card -->
                <div class="info-card management-card">
                    <div class="card-header">
                        <h3>
                            <span style="display: flex; align-items: center; gap: 0.5rem;">
                                <span style="font-size: 1rem;">‚öôÔ∏è</span>
                                Task Management
                            </span>
                        </h3>
                    </div>
                    <div class="card-content">
                        <div class="management-buttons">
                            <!-- Start Button - visible unless already RUNNING -->
                            <ng-container *ngIf="task.status !== 'RUNNING'">
                                <button class="management-btn start" 
                                        [disabled]="isGuest()"
                                        (click)="startTask()"
                                        title="Start task execution">
                                    <span class="btn-icon">‚ñ∂Ô∏è</span>
                                    Start
                                </button>
                            </ng-container>

                            <!-- Pause Button - visible only while RUNNING (disabled for now) -->
                            <ng-container *ngIf="task.status === 'RUNNING'">
                                <button class="management-btn pause" 
                                        [disabled]="true"
                                        (click)="pauseTask()"
                                        title="Pause task execution (disabled)">
                                    <span class="btn-icon">‚è∏Ô∏è</span>
                                    Pause
                                </button>
                            </ng-container>

                            <!-- Continue Button - visible only while PAUSED (disabled for now) -->
                            <ng-container *ngIf="task.status === 'PAUSED'">
                                <button class="management-btn resume" 
                                        (click)="resumeTask()"
                                        [disabled]="true"
                                        title="Continue task execution (disabled)">
                                    <span class="btn-icon">‚ñ∂Ô∏è</span>
                                    Continue
                                </button>
                            </ng-container>

                            <!-- Delete Button - always visible -->
                            <button class="management-btn delete" 
                                    (click)="deleteTask()"
                                    [disabled]="isGuest()"
                                    title="Delete task permanently">
                                <span class="btn-icon">üóëÔ∏è</span>
                                Delete
                            </button>
                        </div>
                        <!-- <div class="status-info">
                            <span class="info-text">
                                Current Status: <strong [ngClass]="'status-text-' + task.status.toLowerCase()">{{ getStatusText(task.status) }}</strong>
                            </span>
                        </div> -->
                    </div>
                </div>





                <!-- Description Card -->
                <div class="info-card description-card" *ngIf="task.description">
                    <div class="card-header">
                        <h3>Description</h3>
                    </div>
                    <div class="card-content">
                        <p class="description-text">{{ task.description }}</p>
                    </div>
                </div>
            </div>
        </ng-container>
    </main>
    <footer>
        <div class="footer-actions" *ngIf="task && !loading && !error">
            <span class="last-updated">Last updated: {{ lastUpdate }}</span>
        </div>
    </footer>  
</div>